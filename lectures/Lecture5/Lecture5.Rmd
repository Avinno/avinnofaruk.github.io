---
width: 1440
height: 900
output: 
  revealjs::revealjs_presentation:
    css: ../header.css
    theme: default
    reveal_options:
      controls: false
      slideNumber: false
      previewLinks: true
      progress: true
      logo: true
    center: false
    highlight: default
    transition: none
    mathjax: default
    slide_level: 1
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(tidyquant)
library(knitr)
library(kableExtra)
```

<style type="text/css">
  .reveal p {
    text-align: left;x
  }
  .reveal ul {
    display: block;
  }
  .reveal ol {
    display: block;
  }
  td {
   font-size: 16px;
  }
</style>

<script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../pdf.css' : '../paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

<section class=center>
## Lecture 5: Evidence from the CAPM and the APT (and related models)
</section>

---

# Tests of the CAPM

* To test the validity of a model, we need to test its predictions
* CAPM predicts
    1. A linear relationship between expected excess returns and beta
    2. No other variable has marginal explanatory power/alpha is zero
    3. The risk premium for Beta is positive and equal to the market risk premium
* These predictions can be tested in various ways

---

# Time series tests

* Jensen's alpha: from the CAPM regression,

$$
r_{i,t} - r_{f} = \alpha_{i} + \beta_{i}\bigg(r_{m,t} - r_{f}\bigg) + \epsilon_{i,t}
$$

* Prediction: $\alpha_{i}$ should be jointly zero, i.e. $\alpha_{1} = 0,  \alpha_{2} = 0, \ldots$

* Historical tests have not typically been favorable towards the CAPM
    - Reject that alphas are jointly zero (p=0.02) (Campbell, Lo, Mackinlay 1997)


---

# Time series tests

* Importance of time-series tests, however, is in their interpretation
* Can show joint tests of alpha are equivalent to the following:
    1. Find the Sharpe ratio of the market portfolio and compare it to the portfolio with the highest realized Sharpe ratio over a given period
    2. Time series tests provide statistical comparison of the predicted MVE (the market) and the actual MVE portfolio

---

# Time series tests

* Said otherwise, non-zero alphas suggest the market portfolio lags the realized maximum Sharpe ratio portfolios by more than the CAPM would suggest
* Generally, it is useful to think about CAPM tests/factor model tests as figuring out if the market/factor portfolios are "efficient"
    - Big question: which stocks should we overweight in the market portfolio to make it more efficient?
    
    
---

# Cross-sectional tests

* Cross-sectional tests have been somewhat more favorable

* Rather than regressing returns on returns, we now regress returns on betas
    - Hope to find that betas and returns line up as predicted by security market line
    
* Fama-Macbeth (1973) provides the standard framework for these tests

--- 

# Fama-Macbeth Cookbook

Two-step procedure:

1.  Run time-series regressions to estimate beta for all stocks
$$
r_{i,t} - r_{f} = \alpha_{i} + \beta_{i}(r_{m,t} - r_{f}) + \epsilon_{i,t}
$$
2. Run cross-section regression of average excess returns $r_{i} - r_{f}$ on estimated betas
$$
r_{i} - r_{f} = \lambda_{0} + \lambda_{1} \hat{\beta}_{i} + u_{i}
$$

Prediction: $\lambda_{0} = 0$ and $\lambda_{1} = E(r_{m} - r_{f})$

---

# Fama-Macbeth Cookbook

* However, note that beta estimates are noisy
    - Regressing any variable on a noisy proxy will flatten the slope coefficient
    
* Why?
    - Imagine noise is added to x so that you observe x+e
    - True OLS coefficient is $\lambda_{1} = \frac{Cov(x,y)}{Var(x)}$
    - Estimated OLS coefficient is $\lambda_{1} = \frac{Cov(x+\epsilon,y)}{Var(x+\epsilon)} = \frac{Cov(x,y)}{Var(x) + Var(\epsilon)}$

* So, we expect any regression estimate of the security market line (SML) to be too flat. 

---

# Fama-Macbeth Cookbook

* In response, we form portfolios of stocks and hope that idiosyncratic noise in beta estimates disappears
    - Why might this help?
    
* Portfolios are formed based on firm betas
    - Why not random assignment?
    
* Actual procedure:
    1. Each year, calculate betas for all firms (past five years data -- 60 months)
    2. Form 10 decile portfolios based on estimated betas
    3. Calculate realized portfolio returns and betas for 10 portfolios
    
    
---

<center>
![Returns v Beta](/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/beta_estimation.png)
<center>

---

# Results

* Evidence is suggestive, but not completely consistent with CAPM
* Positive relation between beta and portfolio returns, but fitted line too flat (Fama, French, JEP 2004)

<center>
![Returns v Beta](/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/capm_returns_v_beta.png)
<center>

---

# Other predictions

* CAPM predicts no other measures of risk will predict cross-sectional returns

* In particular, CAPM says only covariance risk matters
    - What about idiosyncratic risk?
    - Fama-Macbeth (1973) control for idiosyncratic risk by including residual variances from firm time-series regressions in second-stage regression
    - Also beta squared

$$
r_{i} - r_{f} = \lambda_{0} + \lambda_{1} \widehat{\beta}_{i} + \lambda_{2}\widehat{\beta}^{2}_{i} + \lambda_{3}\widehat{\sigma}^{2}_{e} + e_{i}
$$

* They find that only $\beta$ seems to matter -- it's a linear relationship

---

# The search for anomalies begins

* However, we can go beyond beta-squared and residual variation to predict returns...

* For example:
    1. Earnings-to-price ratio $\longrightarrow$ high returns (Basu, 1977)
    2. Market cap  $\longrightarrow$ low returns (Banz, 1981)
    3. Leverage  $\longrightarrow$ high returns (Bhandari, 1988)
    4. Book-to-market  $\longrightarrow$ high returns (Statman, 1980)
    
* All turn out to have predictive power over beta, in particular, size (market cap) and book-to-market

* So which wins in a race, beta or size?

---

# The search for anomalies begins

* Fama-French (1992) test this by creating double sorted portfolios
    - First, sort firms on size; then, sort on beta (cov with market)
    - Can do the same with book-to-market
* Set up a horse-race between beta and the two other factors
* If beta is a good predictor, it should predict even with a bin of similarly sized firms

---

# Average Returns, Post-Ranking Betas and Average Size on Portfolios (Fama-French 1992)

```{r,  out.width='1600px' , fig.asp = .4,  message=FALSE, warning=FALSE}
library(readxl)
famafrench_sort <- read_excel("~/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Data/famafrench_sort.xlsx")
fama_french_sort <- famafrench_sort %>% gather(beta, return, -sort) %>%
  mutate(sort = as.factor(sort), beta =  as.factor(beta))


ggplot(data = fama_french_sort  %>% filter(beta == "All")) + 
  geom_col(aes(x = sort, y = return), fill = "#00356B") +
  theme_minimal() +
  theme(text = element_text(size=18, 
                            family="News Cycle"))  +
  labs(x="Size Portfolios, by Decile", y = "", title= "Average Monthly Returns (%)") 

```

---


# Average Returns, Post-Ranking Betas and Average Size on Portfolios  (Fama-French 1992)


```{r,  out.width='1600px' , fig.asp = .5,  message=FALSE, warning=FALSE}
ggplot(data = fama_french_sort  %>% filter(beta != "All") %>% mutate(beta = as.factor(as.numeric(beta)))) + 
  geom_col(aes(x = beta, y = return), fill = "#00356B") +
  facet_wrap(~sort,  nrow=2) +
  theme_minimal() +
  theme(text = element_text(size=18, 
                            family="News Cycle"))  +
  labs(x="Beta Portfolios, by Decile", y = "", title= "Average Monthly Returns by Size Decile (%)") 
```

---

<center>
![BookMarket v Beta](/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/capm_b_m_portfolio_returns_v_beta.png)
</center>

---

# Is Beta is dead?

* 30 years after its birth, hard to say that CAPM isn't dead

* In reality, however, hard to say if CAPM or tests of the CAPM are flawed

* Roll’s critique:
    - Tests of the CAPM are infeasible because the market portfolio is unobservable
    - Tests of CAPM are only tests of the efficiency of the market proxy used
    
---

# Factor Models

* In spite of being largely credited with the temporary demise of the CAPM, Fama-French argue we need more flexible market proxies
* They advocate multiple factor models that capture the spirit of the CAPM
    - i.e. expected returns dictated by exposure to non- diversifiable risk
    - Size and book-to-market are not “characteristics” but proxies for economic risk factors
    
    
---

# Fama-French 3 factor model

* Create factor mimicking portfolios
    - HML (returns from high B/M stocks less returns from low B/M stocks)
    - SMB (returns from high market cap less returns from low market cap stocks)
    - Data available here: http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html
* Sort firms into portfolios based on size and value
    - Estimate the following regression for different portfolios
    
$$
r_{i}- r_{f} = \alpha + b_{i} \times (r_{m} - r_{f}) + s_{i}\times SMB + h_{i}\times HML + \epsilon_{i}
$$
    - to test
    
$$
E(r_{i}- r_{f}) =  b_{i} \times E(r_{m} - r_{f}) + s_{i}\times E(SMB) + h_{i}\times E(HML) 
$$

---

# Fama-French 3 factor model

$$
E(r_{i}- r_{f}) =  b_{i} \times E(r_{m} - r_{f}) + s_{i}\times E(SMB) + h_{i}\times E(HML) 
$$

<center>
![Fama_FrenchTable](/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/fama_french_3factor_table.png)
</center>


---

# Fama-French 3 factor model

* Claim: Size and value premia reflect exposure to risk captured in SMB and HML
* High returns which are not associated with risk factors should be arbitraged away
* Alphas of size and book-to-market portfolios jointly zero, once we control for SMB and HML risk factors
* This ensures the model is closer to a CAPM/APT story, but is source of some debate

---

# More factors (?!): Momentum

* Often times a fourth factor -- momentum -- is added to the portfolio
* Based on results that suggest that a strategy of buying winners and selling losers can earn a significant premium over a buy-and-hold strategy
* Note: again, we have taken a firm characteristic (recent success), made a portfolio out of it, and called it a "risk-factor"
    - Is this reasonable?
    
    
---

# Momentum Returns

```{r,  out.width='1600px' , fig.asp = .5,  message=FALSE, warning=FALSE}
momentum <- read_excel("~/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Data/momentum.xlsx")
ggplot(data = momentum) + 
  geom_line(aes(x = months_following, y = cum_diff), color = "#00356B") +
  theme_minimal() +
  theme(text = element_text(size=18, 
                            family="News Cycle"))  +
  labs(x="Months Following 6 Month Performance Period", y = "", 
       title= "Cumulative Difference Between Winner and Loser Portfolios") +
  geom_hline(yintercept = 0) + 
  xlim(1,36)

```

---

# More factors -- Liquidity

* Illiquid stocks tend to offer higher returns
    - Can be measured based on bid-ask spreads
    - CAPM assumes away transaction costs
    
* Alternatively, we can characterize liquidity as a risk factor
    - Illiquidity of stocks is correlated -- "systemic" liqudity
    - Systemic liquidity varies over time
    - Stocks exposed to liuqidity risk need to compensate investors with additional risk premia
    

---

# More factors—Liquidity

* Pastor and Stambaugh (2002) create a liquidity factor, $LIQ$
    - $LIQ_{t}$ is low when order flows have a large impact on prices
* We can add this factor to our 3 factor model:

$$
E(r_{i} - r_{f}) = \beta_{i} E(r_{m} - r_{f}) + s_{i}E(SMB) + h_{i}E(HML) + l_{i}E(RP_{liq})
$$

* Hedge funds sell exposure to liquidity risk
    - As long as you don't need liquitiy when everyone else does, might as well get paid for it!
    
    
---

# Factors: risks or opportunities?

* Note the theme here
    - No shares are over/underpriced (almost)
    - Risk-premia paid on assets represent exposure to risk factors
    - Otherwise, "arbitrageurs" will quickly drive prices to equilibrium "correct" values
    - They need deep pockets!
* No free lunch $\rightarrow$ high returns = high risk exposure
* Different **kinds** of risk
    - Some institutions/investors prefer certain types of exposures

---

# The Factor Zoo

* We discussed many potential factors
    - Fama French 3 Factors, Momentum, Liquidity
* Why stop at 5? 
    - Can continue to capture as many risks as possible!
* Why such a small number of factors?

---

# The Factor Zoo

* The estimation of systemic risk exposure relies on a limited amount of historical data
* Dumping in many historical risk factors that are correlated will give:
    - marginal gains
    - noisy estimates
* When you predict based on those estimates, you will get noisy output
    - Garbage in, garbage out!
* Many approaches to fix this

---

# Taming the Factor Zoo (Feng, Giglio and Xiu)

* A new approach: use machine learning to identify the "best" factors
* Feng Giglio and Xiu use "double-selection Lasso", which will identify factors which capture the most important loadings in the cross-section
* They test 15 new contributed factors in the literature, and 4 out of 15 predictive beyond what was already studied in the literature. 


