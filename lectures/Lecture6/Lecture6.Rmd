---
width: 1440
height: 900
output: 
  revealjs::revealjs_presentation:
    css: ../header.css
    theme: default
    reveal_options:
      controls: false
      slideNumber: false
      previewLinks: true
      progress: true
      logo: true
    center: false
    highlight: default
    transition: none
    mathjax: default
    slide_level: 1
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(tidyquant)
library(knitr)
library(kableExtra)
```

<style type="text/css">
  .reveal p {
    text-align: left;x
  }
  .reveal ul {
    display: block;
  }
  .reveal ol {
    display: block;
  }
  td {
   font-size: 16px;
  }
</style>

<script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../pdf.css' : '../paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

<section class=center>
## Lecture 6: Active Portfolio Management
</section>

---

# Preview of our Goal

* The CAPM suggests that all investors should hold the market index
    - This view is based on assumption that all investors share the same information

* What if you have extra information?
    - How do we combine new information with an otherwise efficient portfolio?
    - (What makes the portfolio "efficient"?)
    
* In theory, the Markowitz model will do this, but not for the universe of *investable* assets

---

# Preview of our Goal

* Instead, we replace full-blown portfolio optimization (Markowitz) with a single-factor model based on the CAPM
    - Using inputs from the model, we can build an active portfolio
        + This is called the "satellite portfolio"
    - Optimally combine this active portfolio with the market index 
        + This is called the "core portfolio"

* This two-part procedure is referred to as Treynor-Black, and gives flexibility to account for added-value estimates of alpha or beta, while still remaining diversified

---

# Computation costs of full-blown portfolio optimization

* Suppose we wish to perform full Markowitz portfolio optimization for the S&P500, with or without private information

* How many parameters would we need?

| Parameter | General Number | S&P Number|
|------------------|------------------------|:---:|
| $\sigma_{i}^{2}$ | Number of Stocks ($N$) | 500 |
| $E(r_{i})$       | $N$  | 500 |
| $\sigma_{i,j}$   | $\frac{1}{2} \times N \times (N-1)$ | 124,750 |
| Total | $\frac{1}{2} \times N \times (N+3)$ | 125,750 |

* What about the Wilshire 5000 (all stocks)?

--- 

# A Single Factor Alternative

* We can use a CAPM/single-factor relation to simplify inputs

* We begin with the CAPM regression (note: BKM call this the "Single Index Model")

$$
r_{i,t} - r_{f} = \alpha_{i} + \beta_{i}(r_{m,t} - r_{f}) + \epsilon_{i,t}
$$

$$
\epsilon_{i,t} \sim \mathcal{N}(0, \sigma_{i}^{2}(\epsilon))
$$

* Degree of *idiosyncratic* variance $\sigma_{i}^{2}(\epsilon)$ is allowed to vary for different stocks

* Additionally, we assume that $Cov(\epsilon_{i,t}, \epsilon_{j,t}) = cov(\epsilon_{i,t}, r_{m,t}) = 0$

* What does this buy us?

---

# Single Index Model

* To get expected returns, we take expectations of both sides of the return equation, and generate our security market line

$$
E(r_{i} - r_{f}) = \alpha_{i} + \beta_{i}E(r_{m,t} - r_{f}) 
$$

* Use betas to get variances and covariances:

$$
\sigma_{i,j} = cov(r_{i}, r_{j}) = \beta_{i}\beta_{j}\sigma_{m}^{2}, \; i \not= j
$$

$$
\sigma_{i}^{2} = \beta_{i}^{2}\sigma_{m}^{2} + \sigma_{i}^{2}(\epsilon)
$$

* Why is this helpful?

---

# Single-Index Model

* Now, to construct an efficient frontier, we only need a handful of parameters!

| Parameter | General Number | S&P Number|
|------------------|------------------------|:---:|
| $E(r_{m})$ | 1 | 1 |
| $r_{f}$ | 1 | 1 |
| $\sigma_{m}^{2}$ | 1 | 1|
| $\alpha_{i}$       | $N$  | 500 |
| $\beta_{i}$       | $N$  | 500 |
| $\sigma_{i}^{2}$   | $N$  | 500 |
| Total | $(N+3)$ | 1,503 |

* A lot easier than 125K parameters! 

* Pop Quiz: If alphas are all zero, and all assets are included, what portoflio do we choose?

---

# Modifying inputs with a single- index model

* Single index mocel brings both parsimony and discipline to inputs

* CAPM presents an equilibrium view of expected returns vs. reliance on messy historical returns

* Consider the following exercise (which we will do now):
    1. Estimate expected returns and covariances from the data
    2. Calculate the optimal market portfolio
    3. Construct each stock's beta with the market portfolio
    4. Back out the expected returns from the model and compare
    
* What do we miss by doing this?
    
* We can effectively take the input from the CAPM
    - Plus or minus alpha...
    - What if we need to adjust betas as well?
    
---

# Treynor-Black Model

* This is almost the Treynor-Black Model

* So far, we have looked at a small number of assets for convenience

* In reality, however, even the most diligent analysts will only have valuable views on a handful of assets

* How do we achieve benefits of diversification while still focusing our views on a handful of stocks?

---

# Treynor-Black Model

* Treynor-Black model suggests a two-stage, core/satellite approach
    - First stage: build active portfolio based on alpha estimates
    - Second stage: decide how much to contribute to active portfolio and how much to allocate to index
    
* Portfolio will maximize the Sharpe ratio of the total portfolio


---

# Treynor-Black Model

* First, construct the active portfolio (A) using alpha estimates and observed residual variance

$$
w_{i}^{0} = \frac{\alpha_{i} / \sigma^{2}_{i}(\epsilon)}{\sum_{j} \alpha_{j} / \sigma^{2}_{j}(\epsilon)}
$$

* $w_{i}^{0}$ is the optimal weight to put on stock $i$ within the active portfolio $A$

* $\alpha_{i}$ is the expected excess return over the CAPM prediction for stock $i$

* $\sigma_{i}^{2}(\epsilon)$ is the residual (idiosyncratic) variation of stock $i$

* So, how do we interpret this equation?

---

# How much to allocate to the active portfolio?

* Next decide how much to put in the active portfolio, $w_{A}$?

* Solving this analytically yields

$$
w_{A} = \frac{\alpha_{A} / \sigma_{A}^{2}(\epsilon)}{E(r_{m}-r_{f})/\sigma_{m}^{2} + (1-\beta_{A})(\alpha_{A}/\sigma_{A}^2(\epsilon))}
$$

where 
$$
\beta_{A} = \sum_{i \in A} w_{i}\beta_{i}, \qquad \alpha_{A} = \sum_{i \in A} w_{i}\alpha_{i}, \qquad   \sigma^{2}_{A}(\epsilon) = \sum_{i \in A} w_{i}^{2}\sigma^{2}_{i}(\epsilon) 
$$

* What happens as $\alpha_{A}$ gets large? Or $\sigma_{A}^{2}$ gets small?
    - What about the market's Sharpe ratio?
    
* Final active portfolio weight on stock $i$ is $w_{i}^{A} \times w_{A}$

* $(1- w_{A})$ is invested in the passive index

---

# Example

* Market returns are 9\%  with a variance, $\sigma_{m}^{2}$ of 4% and a risk-free rate of 3%

* Combine the index with the following beliefs regarding Facebook and Twitter:

| | $\alpha$ | $\beta$ | $\sigma_{i}^{2}(\epsilon)$|
|-|----------|---------|--------------------------|
|FB  |0.5\% | 2 | 7\% |
|TWTR|0.2\% | 1.75 | 12\% | 

* What are we assuming about the other stocks?

* Plugging in to get active weights yields:

$$
w_{FB}^{0} = \frac{ \alpha_{FB} \big/ \sigma_{FB}^{2}(\epsilon)}{ \alpha_{FB} \big/ \sigma_{FB}^{2}(\epsilon) + \alpha_{TWTR} \big/ \sigma_{TWTR}^{2}(\epsilon)} = 0.81, \qquad w_{TWTR}^{0} = 0.19
$$

---

# Example

* Based on these weights,

$$
\begin{aligned}
\beta_{A} &= 0.81 \times 2 + 0.19 \times 1.75 = 1.95\\
\alpha_{A} &= 0.81 \times 0.005 + 0.19 \times 0.002 = 0.0044\\
\sigma_{A}^{2}(\epsilon) &= 0.81^{2} \times 0.07 + 0.19^{2} \times 0.12 = 0.05
\end{aligned}
$$

* This gives us the active weight

$$
w_{A} = \frac{\alpha_{A} / \sigma_{A}^{2}(\epsilon)}{E(r_{m}-r_{f})/\sigma_{m}^{2} + (1-\beta_{A})(\alpha_{A}/\sigma_{A}^2(\epsilon))} =  \frac{0.0044/ 0.05}{0.06/0.04 + (1-1.95)(0.0044/ 0.05)} = 0.06
$$

---

# Example

* So we invest roughly 6\% in an active portfolio, and 94\% in the index

* Given the active portfolio weights in FB and TWTR, we get final portfolio weights of 94\% for the index, 5\% for FB, and 1\% TWTR


---

# Treynor-Black

* Active management tells us to think about our portfolios seperately 
    - One active portfolio
    - One passive portfolio
    
* What does the typical mutual fund represent?
    - Depends on the fund benchmark
    - For example, sector/style funds vs. balanced funds
    
* For an undiversified fund, passive investing is done "after-market"

---

# Active Portfolio Management in Practice

* Are funds over-indexing?
    - Bob Litterman says so...

<center>
```{r  out.width = "75%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/litterman.png') 
```
</center>

---

# Active Portfolio Management in Practice


<center>
```{r  out.width = "75%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/fama_french_alpha2.png') 
```
</center>

---

# Active Portfolio Management in Practice

<center>
```{r  out.width = "75%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/fama_french_alpha1.png') 
```
</center>

---

# Hot hands? 

* Evidence for persistent superior performance is weak

* Malkiel (1995) tracks funds based on above/below median performance

<center>
![Returns v Beta](/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/malkiel_persistence.png)
</center>

* Is alpha the right measure? Van Binsbergen and Berk (2011)

---

# Active & Passive Components of a Portfolio

* How do we observe if funds are active or passive?
    - One idea is tracking error; $sd(r_{fund}-r_{index})$

* Alternatively, the active share (Cremers and Petajisto, 2009)
    
* Decompose portfolio into two parts:

$$
\text{Portfolio} = \text{Index} + (\text{Portfolio} - \text{Index})
$$

* Distinguish the truly active funds from those who are not very active, but only advertise themselves as active
    - e.g. Fidelity Magellan in 2003

---

# Active Share

* Active Share quantifies active portfolio holdings
    - Compare portfolios weights: fund versus its benchmark
    
$$ 
\text{Active Share}_{fund} = \frac{1}{2}\sum \left| w_{fund, stock} - w_{index, stock} \right|
$$

* Indicates the size of the active positions as a fraction of the entire portfolio

* Always between 0 and 100\% for mutual funds
    - E.g. 34% for Fidelity Magellan at the end of 2003
    
    
---

# Magellan's Period of Closet Indexing

<center>
![Returns v Beta](/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/magellan.png)
</center>

    
---

# Magellan's Period of Closet Indexing
    
<center>
```{r  out.width = "75%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/magellan2.png') 
```
</center>


---

# Evolution of Active Share over Time

<center>
```{r  out.width = "75%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/active_share.png') 
```
</center>


---

# Compare Active to Passive Funds


<center>
```{r, out.width='1600px' , fig.asp = .5}
#include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/active_share2.png') 
index_fund_size <- tibble(ret = c(1.71, 1.39, 1.15, 0.19, -0.67, -2.06, -1.81, -1.90, -1.64, -1.69), 
                          active = c(rep("High Active Share",5),rep("Low Active Share",5)),
                          size_quint = c(1,2,3,4,5,1,2,3,4,5))
ggplot(data = index_fund_size) +
  geom_col(aes(y = ret, x = size_quint, fill = active), position = "dodge2") + 
  labs(x="Size Quintile", y = "", title="Annualized Net Fund Alpha (p.p.) across sizes") +
  theme_minimal() +
  theme(text = element_text(size=18, 
                            family="News Cycle")) 

```
</center>


---

# Greater Performance Persistence for Active Funds


<center>
```{r  out.width='1600px' , fig.asp = .5}
index_fund_size <- tibble(ret = c(-0.98, 0.39, 0.89, 1.04, 3.50, -2.05, -2.26, -1.78, -1.52, -1.58), 
                          active = c(rep("High Active Share",5),rep("Low Active Share",5)),
                          size_quint = c(1,2,3,4,5,1,2,3,4,5))
ggplot(data = index_fund_size) +
  geom_col(aes(y = ret, x = size_quint, fill = active), position = "dodge2") + 
  labs(x="Prior Year Return Quintile", y = "", title="Annualized Net Fund Alpha (p.p.) across prior year return") +
  theme_minimal() +
  theme(text = element_text(size=18, 
                            family="News Cycle")) 

#include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/active_share3.png') 
```
</center>

---

# Greater Performance  for Active Funds

<center>
```{r  out.width = "75%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/active_share4.png') 
#include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/active_share2.png') 

```
```
</center>


---

# Black-Litterman

* Treynor-Black addresses the trade-off between diversification and conviction
    - Even ex-ante correct beliefs can be wrong after the fact!
    - i.e. alpha belief is right, but error term $\epsilon$ went the wrong way
* Black-Litterman admits uncertain beliefs about alpha and other inputs beforehand
    - Think Bayesian!
    - But not this Bayes:
    

<center>
```{r  out.width = "40%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/bayes1.jpg') 
```
</center>

---

# Or even this Bayes:

<center>
```{r  out.width = "40%"}
include_graphics('/Users/PSG24/Dropbox/Teaching/MGT544Spring2019/Class Lectures/Pictures/bayes2.jpg') 
```
</center>

---

# Black-Litterman Cookbook

* The Black-Litterman approach is much less fluffy.

* Straightforward approach to incorporate three things:

    1. optimal portfolio design (mean variance trade-off)
    2. active trading (non-zero alpha)
    3. uncertainty (Bayesian shrinkage)

* Approach is somewhat technical, so we will first walk through the cookbook

---

# Black-Litterman Cookbook

Step 1:

* Invert expected returns based on observed portfolio weights and covariances
    - I.e. "What must others believe about E(r) to justify weights?"
    - With the universe of stocks, the CAPM already does this
    
* This gives rise to a noisy estimate of expected returns from a market equilibrium
*  Assign a level of uncertainty to this estimate (tau $\tau$)

---

# Black-Litterman Cookbook

Step 2:

* Come up with an independent estimate of $E(r)$, your "view"

* Assign a level of uncertainty to this estimate (Omega $\omega$)

---

# Black-Litterman Cookbook

Step 3:

* Use Bayes' rule to formulate posterior distribution of $E(r)$ as a weighted average of views + equilibrium estimates, weighted by precision (inverse uncertainty)

* Proceed with MVE based on refined view of expected returns and covariance matrix



